<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üèê Liga 4x4 - Agendamentos</title>

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,Arial;}
body{
  background:linear-gradient(90deg,#004aad 0%,#0d99ff 100%);
  min-height:100vh;padding:20px;color:#fff;
}
.container{
  max-width:650px;margin:0 auto;
  background:rgba(255,255,255,0.1);
  border-radius:20px;padding:25px;
  box-shadow:0 20px 40px rgba(0,0,0,0.3);
  backdrop-filter:blur(15px);
}
h1,h2{text-align:center;font-weight:800;}
h1{font-size:28px;margin-bottom:10px;}
h2{font-size:20px;margin:30px 0 15px;color:rgba(255,255,255,0.9);}
.ofertas{max-height:60vh;overflow-y:auto;}
.oferta{
  background:rgba(255,255,255,0.1);
  border-radius:16px;padding:20px;margin-bottom:15px;
  box-shadow:0 10px 25px rgba(0,0,0,0.2);
  border-left:5px solid #ff6b6b;
}
.oferta-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
.oferta-header h3{margin:0;font-size:20px;}
.status{padding:6px 12px;border-radius:20px;font-size:14px;font-weight:700;}
.status-disponivel{background:rgba(255,193,7,0.3);color:#ffc107;}
.status-confirmado{background:rgba(40,167,69,0.3);color:#28a745;}
.oferta-detalhes{font-size:14px;opacity:0.9;}
.btn-group{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;}
.btn{
  padding:10px 20px;border:none;border-radius:999px;
  font-weight:700;cursor:pointer;
  box-shadow:0 6px 16px rgba(0,0,0,0.3);
  transition:.3s;font-size:14px;
}
.btn:hover{transform:translateY(-2px);}
.btn-primary{background:linear-gradient(135deg,#28a745,#20c997);color:#fff;}
.btn-aceitar{background:linear-gradient(135deg,#ffc107,#ff8f00);color:#000;font-size:16px;padding:12px 25px;}
.btn-cancelar{background:#dc3545;color:#fff;}
#btnFlutuante{
  position:fixed;bottom:25px;right:25px;
  background:linear-gradient(135deg,#28a745,#20c997);
  color:#fff;border:none;border-radius:50%;
  width:70px;height:70px;font-size:42px;
  cursor:pointer;box-shadow:0 10px 25px rgba(0,0,0,0.4);
  transition:.3s;z-index:9999;
}
#btnFlutuante:hover{transform:scale(1.1);}
#loginScreen{
  display:none;position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.9);z-index:10000;
  justify-content:center;align-items:center;flex-direction:column;color:#fff;
}
#loginScreen input{
  width:300px;max-width:90vw;padding:15px;border-radius:12px;
  border:none;font-size:18px;margin-bottom:15px;background:rgba(255,255,255,0.9);
}
.login-btn{
  width:300px;max-width:90vw;padding:15px 20px;border:none;border-radius:12px;
  background:linear-gradient(135deg,#28a745,#20c997);
  color:#fff;font-size:18px;font-weight:700;cursor:pointer;
  box-shadow:0 8px 20px rgba(40,167,69,0.4);
}
</style>
</head>

<body>
<div class="container">
  <h1>üèê Liga 4x4 - Agendamentos</h1>
  <div id="listaOfertas" class="ofertas">
    <div style="text-align:center;padding:30px;opacity:0.7;">üîÑ Carregando ofertas...</div>
  </div>
</div>

<button id="btnFlutuante" onclick="novaOferta()">+</button>

<div id="loginScreen">
  <h2>üîê Entrar na Liga 4x4</h2>
  <p style="margin-bottom:20px;font-size:18px;">Digite a senha do seu time ou <b>liga4x4</b> (admin)</p>
  <input type="password" id="senhaInput" placeholder="ex: voleitche, liga4x4...">
  <button class="login-btn" onclick="entrar()">Entrar</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
firebase.initializeApp({
  apiKey: "AIzaSyCovHcUFKP9dtwRxfnajhvGUgluCFp0HVQ",
  authDomain: "liga4x4volei-71358.firebaseapp.com",
  projectId: "liga4x4volei-71358"
});
const db=firebase.firestore();
const REF=db.collection("ofertasHorario");

const SENHAS_TIMES={
  "liga4x4":"ADMIN","watchatchara":"Watchatchara","iron":"Iron","matrix":"Matrix",
  "filhosdafenix":"Filhos da F√™nix","summer":"Summer","hungers":"Hungers","voleitche":"V√¥lei Tche",
  "conflitus":"Conflitus","baroesdalargadinha":"Bar√µes da Largadinha","falcoes":"Falc√µes",
  "time11":"Time 11","time12":"Time 12"
};

let usuarioAtual=null;

function abrirLogin(){
  document.getElementById('loginScreen').style.display='flex';
  document.getElementById('senhaInput').focus();
}
function entrar(){
  const senha=document.getElementById('senhaInput').value.toLowerCase().trim();
  if(!SENHAS_TIMES[senha]){alert("‚ùå Senha inv√°lida!");return;}
  usuarioAtual={senha,nome:SENHAS_TIMES[senha],isAdmin:senha==="liga4x4"};
  document.getElementById('loginScreen').style.display='none';
  alert(`‚úÖ Logado como ${usuarioAtual.isAdmin?"ADMIN":usuarioAtual.nome}`);
  carregarOfertas();
}

async function carregarOfertas(){
  const lista=document.getElementById('listaOfertas');
  const snap=await REF.orderBy("dataCriacao","desc").get();
  let html="";
  snap.forEach(doc=>{
    const o=doc.data();
    const dataFmt=new Date(o.data).toLocaleDateString('pt-BR');
    const status=o.status==="confirmado"?"status-confirmado":"status-disponivel";
    const txt=o.status==="confirmado"?"‚úÖ Confirmado":"‚è≥ Dispon√≠vel";
    let botoes="";
    if(!o.aceitoPor && usuarioAtual){
      if(usuarioAtual.isAdmin){
        botoes=`
          <div class="btn-group">
            <select id="aceitarTime_${doc.id}">
              ${Object.values(SENHAS_TIMES).filter(t=>t!=="ADMIN").map(t=>`<option>${t}</option>`).join('')}
            </select>
            <button class="btn btn-aceitar" onclick="aceitarOferta('${doc.id}','${o.timeOfertante}')">‚úÖ ACEITAR</button>
          </div>`;
      } else if(usuarioAtual.nome!==o.timeOfertante){
        botoes=`<button class="btn btn-aceitar" style="width:100%;" onclick="aceitarOferta('${doc.id}','${o.timeOfertante}')">‚úÖ ACEITAR JOGO</button>`;
      }
    }
    if(usuarioAtual && (usuarioAtual.isAdmin || usuarioAtual.nome===o.timeOfertante)){
      botoes+=`<button class="btn btn-cancelar" style="width:100%;margin-top:8px;" onclick="cancelarOferta('${doc.id}')">‚ùå CANCELAR</button>`;
    }
    html+=`
      <div class="oferta">
        <div class="oferta-header"><h3>${o.quadra} ‚Äì ${o.hora}</h3><span class="status ${status}">${txt}</span></div>
        <div class="oferta-detalhes">üìÖ ${dataFmt}<br>üèê ${o.timeOfertante}${o.aceitoPor?` x <b>${o.aceitoPor}</b>`:" (aguardando...)"}</div>
        ${botoes?`<div style="margin-top:15px;">${botoes}</div>`:""}
      </div>`;
  });
  lista.innerHTML=html||"<div style='text-align:center;padding:20px;'>üì≠ Nenhuma oferta ainda</div>";
}

async function novaOferta(){
  if(!usuarioAtual){abrirLogin();return;}
  let timeOfertante=usuarioAtual.nome;
  if(usuarioAtual.isAdmin){
    const t=prompt("Admin: escolha o time que faz a oferta:\n"+Object.values(SENHAS_TIMES).filter(t=>t!=="ADMIN").join(", "));
    if(!t)return;
    timeOfertante=t;
  }
  const quadra=prompt("üèê Local do jogo (ex: Praia Bel√©m):");
  const data=prompt("üìÖ Data (aaaa-mm-dd):",new Date().toISOString().split("T")[0]);
  const hora=prompt("‚è∞ Hora (hh:mm):","20:00");
  if(!quadra||!data||!hora){alert("‚ùå Campos obrigat√≥rios!");return;}
  await REF.add({
    timeOfertante,quadra,data,hora,
    status:"disponivel",aceitoPor:null,
    dataCriacao:firebase.firestore.FieldValue.serverTimestamp()
  });
  alert("‚úÖ Oferta criada!");
  carregarOfertas();
}

async function aceitarOferta(id,timeOfertante){
  if(!usuarioAtual){abrirLogin();return;}
  let meuTime=usuarioAtual.nome;
  if(usuarioAtual.isAdmin){
    const select=document.getElementById(`aceitarTime_${id}`);
    meuTime=select?select.value:meuTime;
  }
  if(meuTime===timeOfertante){alert("‚ùå N√£o pode aceitar o pr√≥prio jogo!");return;}
  await REF.doc(id).update({
    status:"confirmado",aceitoPor:meuTime,
    dataAceite:firebase.firestore.FieldValue.serverTimestamp()
  });
  alert(`üéâ Jogo confirmado!\n${timeOfertante} x ${meuTime}`);
  carregarOfertas();
}

async function cancelarOferta(id){
  if(!confirm("Cancelar esta oferta?"))return;
  await REF.doc(id).delete();
  carregarOfertas();
}

async function limparAntigos(){
  const snap=await REF.where("status","==","confirmado").get();
  const agora=Date.now();
  for(const doc of snap.docs){
    const d=doc.data();
    if(d.dataAceite && (agora - d.dataAceite.toDate().getTime()) > 3*24*60*60*1000){
      await REF.doc(doc.id).delete();
    }
  }
}

carregarOfertas();
setInterval(limparAntigos,1000*60*60);
</script>
</body>
</html>
