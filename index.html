<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üèê Liga 4x4 - Agendamentos</title>

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,Arial;}
body{
  background:linear-gradient(90deg,#004aad 0%,#3db2ff 100%);
  min-height:100vh;padding:20px;color:#fff;
}

/* Container principal */
.container{
  max-width:650px;margin:0 auto;
  background:rgba(255,255,255,0.1);
  border-radius:20px;padding:25px;
  box-shadow:0 20px 40px rgba(0,0,0,0.3);
  backdrop-filter:blur(15px);
}

/* T√≠tulos */
h1,h2{text-align:center;font-weight:800;}
h1{font-size:28px;margin-bottom:10px;}
h2{font-size:20px;margin:30px 0 15px;color:rgba(255,255,255,0.9);}

/* Ofertas */
.ofertas{max-height:60vh;overflow-y:auto;}
.oferta{
  background:rgba(255,255,255,0.1);
  border-radius:16px;padding:20px;margin-bottom:15px;
  box-shadow:0 10px 25px rgba(0,0,0,0.2);
  border-left:5px solid #ff6b6b;
}
.oferta-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
.oferta-header h3{margin:0;font-size:20px;}
.status{padding:6px 12px;border-radius:20px;font-size:18px;font-weight:700;}
.status-disponivel{background:rgba(255,193,7,0.3);color:#ffc107;}
.status-confirmado{background:rgba(40,167,69,0.3);color:#28a745;}
.oferta-detalhes{font-size:18px;opacity:0.9;}
.btn-group{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;}

/* Bot√µes */
.btn{
  padding:10px 20px;border:none;border-radius:999px;
  font-weight:700;cursor:pointer;
  box-shadow:0 6px 16px rgba(0,0,0,0.3);
  transition:.3s;font-size:14px;
}
.btn:hover{transform:translateY(-2px);}
.btn-primary{background:linear-gradient(135deg,#28a745,#20c997);color:#fff;}
.btn-aceitar{background:linear-gradient(135deg,#ffc107,#ff8f00);color:#000;font-size:16px;padding:12px 25px;}
.btn-cancelar{background:#dc3545;color:#fff;}

/* Bot√£o flutuante (+) */
#btnFlutuante{
  position:fixed;bottom:25px;right:25px;
  background:linear-gradient(135deg,#28a745,#20c997);
  color:#fff;border:none;border-radius:50%;
  width:70px;height:70px;font-size:42px;
  cursor:pointer;box-shadow:0 10px 25px rgba(0,0,0,0.4);
  transition:.3s;z-index:9999;
}
#btnFlutuante:hover{transform:scale(1.1);}

/* Login modal */
#loginScreen{
  display:none;position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.9);z-index:10000;
  justify-content:center;align-items:center;flex-direction:column;color:#fff;
}
#loginScreen input{
  width:300px;max-width:90vw;padding:15px;border-radius:12px;
  border:none;font-size:18px;margin-bottom:15px;background:rgba(255,255,255,0.9);
}
.login-btn{
  width:300px;max-width:90vw;padding:15px 20px;border:none;border-radius:12px;
  background:linear-gradient(135deg,#28a745,#20c997);
  color:#fff;font-size:18px;font-weight:700;cursor:pointer;
  box-shadow:0 8px 20px rgba(40,167,69,0.4);
}

/* Modal Nova Oferta */
.modal {
  display: none;
  position: fixed;
  z-index: 10000;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.8);
  justify-content: center;
  align-items: center;
}

.modal-content {
  background: rgba(255,255,255,0.1);
  backdrop-filter: blur(15px);
  border-radius: 20px;
  padding: 25px;
  width: 90%;
  max-width: 400px;
  color: #fff;
  position: relative;
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.modal-content label {
  font-weight: 600;
  margin-top: 10px;
}

.modal-content select,
.modal-content input {
  width: 100%;
  padding: 10px;
  border-radius: 10px;
  border: none;
  outline: none;
  font-size: 15px;
  background: rgba(255,255,255,0.9);
}

.close-btn {
  position: absolute;
  top: 10px; right: 15px;
  cursor: pointer;
  font-size: 20px;
  color: #fff;
  transition: 0.3s;
}
.close-btn:hover { color: #ff4d4d; }
</style>
</head>
<body>
<div class="container">
  <h1>üèê Liga 4x4 - Agendamentos</h1>
  <div id="listaOfertas" class="ofertas">
    <div style="text-align:center;padding:30px;opacity:0.7;">üîÑ Carregando ofertas...</div>
  </div>
</div>

<!-- Bot√£o flutuante -->
<button id="btnFlutuante" onclick="abrirLogin()">+</button>

<!-- Login -->
<div id="loginScreen">
  <h2>üîê Entrar na Liga 4x4</h2>
  <p style="margin-bottom:20px;font-size:18px;">Digite a senha do seu time ou admin</p>
  <input type="password" id="senhaInput" placeholder="ex: iron, matrix...">
  <button class="login-btn" onclick="entrar()">Entrar</button>
</div>

<!-- Modal de nova oferta -->
<div id="novaOfertaModal" class="modal">
  <div class="modal-content">
    <span class="close-btn" onclick="fecharModal()">‚úñ</span>
    <h2>üìÖ Nova Oferta de Jogo</h2>

    <div id="camposAdmin" style="display:none;">
      <label for="selectOfertante">Time Ofertante:</label>
      <select id="selectOfertante">
        <option value="">Selecione...</option>
      </select>

      <label for="selectOponente" style="margin-top:10px;">Time Oponente (opcional):</label>
      <select id="selectOponente">
        <option value="">Selecione...</option>
      </select>
    </div>

    <label for="quadraSelect">üèüÔ∏è Arena:</label>
    <select id="quadraSelect">
      <option value="">Selecione...</option>
      <option>Arena Bel√©m</option>
      <option>Arena Meteoro</option>
      <option>Arena Madrid</option>
      <option>Bel√©m Praia Clube</option>
      <option>Mega Sports</option>
    </select>

    <label for="dataInput">üìÖ Data:</label>
    <input type="" id="dataInput">

    <label for="horaInput">‚è∞ Hora:</label>
    <input type="time" id="horaInput" value="20:00">

    <button class="btn btn-primary" style="margin-top:20px;width:100%;" onclick="salvarOferta()">‚úÖ Salvar Oferta</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
// ==============================
// üî• CONFIGURA√á√ÉO DO FIREBASE
// ==============================
firebase.initializeApp({
  apiKey: "AIzaSyCovHcUFKP9dtwRxfnajhvGUgluCFp0HVQ",
  authDomain: "liga4x4volei-71358.firebaseapp.com",
  projectId: "liga4x4volei-71358"
});
const db = firebase.firestore();
const REF = db.collection("ofertasHorario");

// ==============================
// üèê TIMES E SENHAS
// ==============================
const SENHAS_TIMES = {
  "liga4x426": "ADMIN",
  "watchatchara26": "Watchatchara",
  "iron26": "Iron",
  "matrix26": "Matrix",
  "filhosdafenix26": "Filhos da F√™nix",
  "summer26": "Summer",
  "hungers26": "Hungers",
  "voleitche26": "V√¥lei Tche",
  "conflitus26": "Conflitus",
  "baroesdalargadinha26": "Bar√µes da Largadinha"
};

let usuarioAtual = null;

// ==============================
// üîê LOGIN E CONTROLE
// ==============================
function abrirLogin() {
  document.getElementById('loginScreen').style.display = 'flex';
  document.getElementById('senhaInput').focus();
}

function entrar() {
  const senha = document.getElementById('senhaInput').value.toLowerCase().trim();
  if (!SENHAS_TIMES[senha]) {
    alert("‚ùå Senha inv√°lida!");
    return;
  }
  usuarioAtual = {
    senha,
    nome: SENHAS_TIMES[senha],
    isAdmin: senha === "liga4x426"
  };
  document.getElementById('loginScreen').style.display = 'none';
  alert(`‚úÖ Logado como ${usuarioAtual.isAdmin ? "ADMIN" : usuarioAtual.nome}`);
  document.getElementById("btnFlutuante").onclick = novaOferta;
  carregarOfertas();
}

// ==============================
// üìÖ ABRIR E FECHAR MODAL
// ==============================
function novaOferta() {
  abrirModal();
}

function abrirModal() {
  if (!usuarioAtual) {
    abrirLogin();
    return;
  }
  document.getElementById("novaOfertaModal").style.display = "flex";

  const camposAdmin = document.getElementById("camposAdmin");
  const selectOfertante = document.getElementById("selectOfertante");
  const selectOponente = document.getElementById("selectOponente");

  if (usuarioAtual.isAdmin) {
    camposAdmin.style.display = "block";
    selectOfertante.innerHTML = `<option value="">Selecione...</option>` + 
      Object.values(SENHAS_TIMES).filter(t => t !== "ADMIN").map(t => `<option>${t}</option>`).join('');
    selectOponente.innerHTML = `<option value="">Selecione...</option>` + 
      Object.values(SENHAS_TIMES).filter(t => t !== "ADMIN").map(t => `<option>${t}</option>`).join('');
  } else {
    camposAdmin.style.display = "none";
  }
}

function fecharModal() {
  document.getElementById("novaOfertaModal").style.display = "none";
}

// ==============================
// üíæ SALVAR NOVA OFERTA
// ==============================
async function salvarOferta() {
  if (!usuarioAtual) {
    abrirLogin();
    return;
  }

  let timeOfertante = usuarioAtual.nome;
  let oponente = null;

  if (usuarioAtual.isAdmin) {
    const sel1 = document.getElementById("selectOfertante").value;
    const sel2 = document.getElementById("selectOponente").value;
    if (!sel1) { alert("‚ùå Escolha o time ofertante!"); return; }
    timeOfertante = sel1;
    oponente = sel2 || null;
  }

  const quadra = document.getElementById("quadraSelect").value;
  const data = document.getElementById("dataInput").value;
  const hora = document.getElementById("horaInput").value;

  if (!quadra || !data || !hora) {
    alert("‚ùå Preencha todos os campos!");
    return;
  }

  await REF.add({
    timeOfertante,
    aceitoPor: oponente,
    quadra,
    data,
    hora,
    status: oponente ? "confirmado" : "disponivel",
    dataCriacao: firebase.firestore.FieldValue.serverTimestamp()
  });

  alert("‚úÖ Oferta criada com sucesso!");
  fecharModal();
  carregarOfertas();
}

// ==============================
// üîÑ CARREGAR OFERTAS (CORRIGIDO)
// ==============================
async function carregarOfertas() {
  const lista = document.getElementById('listaOfertas');
  const snap = await REF.orderBy("dataCriacao", "desc").get();
  
  if (snap.empty) {
    lista.innerHTML = "<div style='text-align:center;padding:20px;'>üì≠ Nenhuma oferta ainda</div>";
    return;
  }

  let html = "";
  snap.forEach(doc => {
    const o = doc.data();
    const id = doc.id;
    const dataFmt = o.data ? new Date(o.data).toLocaleDateString('pt-BR') : "";
    const status = o.status === "confirmado" ? "status-confirmado" : "status-disponivel";
    const txt = o.status === "confirmado" ? "‚úÖ Confirmado" : "‚è≥ Dispon√≠vel";

    let botoes = "";

    // ‚úÖ CORRIGIDO: Bot√µes funcionam perfeitamente!
    if (usuarioAtual) {
      if (!o.aceitoPor && usuarioAtual.isAdmin) {
        // Admin pode escolher quem aceita
        botoes = `
          <div class="btn-group">
            <select id="aceitarTime_${id}">
              ${Object.values(SENHAS_TIMES).filter(t => t !== "ADMIN").map(t => `<option>${t}</option>`).join('')}
            </select>
            <button class="btn btn-aceitar" onclick="aceitarOferta('${id}', '${o.timeOfertante}')">‚úÖ Aceitar</button>
          </div>`;
      } else if (!o.aceitoPor && usuarioAtual.nome !== o.timeOfertante) {
        // ‚úÖ TIME NORMAL V√ä BOT√ÉO ACEITAR (Matrix v√™ oferta do Iron)
        botoes = `<button class="btn btn-aceitar" style="width:100%;" onclick="aceitarOferta('${id}', '${o.timeOfertante}')">‚úÖ Aceitar jogo</button>`;
      }

      if (usuarioAtual.isAdmin || usuarioAtual.nome === o.timeOfertante) {
        botoes += `<button class="btn btn-cancelar" style="width:100%;margin-top:8px;" onclick="cancelarOferta('${id}')">‚ùå Cancelar</button>`;
      }
    }

    html += `
      <div class="oferta">
        <div class="oferta-header">
          <h3>${o.quadra} ‚Äì ${o.hora}</h3>
          <span class="status ${status}">${txt}</span>
        </div>
        <div class="oferta-detalhes">
          üìÖ <b>${dataFmt}</b><br>
          üèê <b>${o.timeOfertante}</b>${o.aceitoPor ? ` x <b>${o.aceitoPor}</b>` : " (aguardando...)"}
        </div>
        ${botoes ? `<div style="margin-top:15px;">${botoes}</div>` : ""}
      </div>`;
  });

  lista.innerHTML = html;
}

// ==============================
// ‚úÖ ACEITAR E CANCELAR
// ==============================
async function aceitarOferta(id, ofertante) {
  if (!usuarioAtual) {
    alert("‚ö†Ô∏è Fa√ßa login para aceitar um jogo.");
    abrirLogin();
    return;
  }

  let meuTime = usuarioAtual.nome;
  if (usuarioAtual.isAdmin) {
    const sel = document.getElementById(`aceitarTime_${id}`);
    meuTime = sel ? sel.value : meuTime;
    if (!meuTime) { alert("‚ùå Escolha um time para aceitar!"); return; }
  }

  if (meuTime === ofertante) {
    alert("‚ùå O mesmo time n√£o pode aceitar a pr√≥pria oferta!");
    return;
  }

  await REF.doc(id).update({
    status: "confirmado",
    aceitoPor: meuTime,
    dataAceite: firebase.firestore.FieldValue.serverTimestamp()
  });

  alert(`üéâ Jogo confirmado: ${ofertante} x ${meuTime}`);
  carregarOfertas();
}

async function cancelarOferta(id) {
  if (!confirm("Tem certeza que deseja cancelar esta oferta?")) return;
  await REF.doc(id).delete();
  carregarOfertas();
}

// ==============================
// üßπ LIMPAR CONFIRMADOS ANTIGOS
// ==============================
async function limparAntigos() {
  const snap = await REF.where("status", "==", "confirmado").get();
  const agora = Date.now();
  for (const doc of snap.docs) {
    const d = doc.data();
    if (d.dataAceite && (agora - d.dataAceite.toDate().getTime()) > 8 * 24 * 60 * 60 * 1000) {
      await REF.doc(doc.id).delete();
    }
  }
}

// ==============================
// üöÄ INICIALIZA√á√ÉO
// ==============================
carregarOfertas();
setInterval(limparAntigos, 1000 * 60 * 60);
document.getElementById("btnFlutuante").onclick = abrirModal;
</script>
</body>
</html>




