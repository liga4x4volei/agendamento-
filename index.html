<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üèê Liga 4x4 - Agendamentos</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,Arial;}
body{
  background:linear-gradient(90deg,#004aad 0%,#0d99ff 100%);
  min-height:100vh;padding:20px;color:#fff;
}
.container{
  max-width:650px;margin:0 auto;
  background:rgba(255,255,255,0.1);
  border-radius:20px;padding:25px;
  box-shadow:0 20px 40px rgba(0,0,0,0.3);
  backdrop-filter:blur(15px);
}
h1,h2{text-align:center;font-weight:800;}
h1{font-size:28px;margin-bottom:10px;}
h2{font-size:20px;margin:30px 0 15px;color:rgba(255,255,255,0.9);}
.public-notice{
  background:rgba(0,0,0,0.3);
  padding:15px;border-radius:12px;
  margin-bottom:20px;text-align:center;
}
.ofertas{max-height:60vh;overflow-y:auto;}
.oferta{
  background:rgba(255,255,255,0.1);
  border-radius:16px;padding:20px;
  margin-bottom:15px;
  box-shadow:0 10px 25px rgba(0,0,0,0.2);
  border-left:5px solid #ff6b6b;
}
.oferta-header{
  display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;
}
.status{
  padding:6px 12px;border-radius:20px;font-size:14px;font-weight:700;
}
.status-disponivel{background:rgba(255,193,7,0.3);color:#ffc107;}
.status-confirmado{background:rgba(40,167,69,0.3);color:#28a745;}
.oferta-detalhes{font-size:14px;opacity:0.9;}
.btn{
  padding:10px 20px;border:none;border-radius:999px;font-weight:700;
  cursor:pointer;box-shadow:0 6px 16px rgba(0,0,0,0.3);
  transition:.3s;font-size:14px;
}
.btn-primary{
  background:linear-gradient(135deg,#28a745,#20c997);
  color:#fff;
}
.btn-aceitar{
  background:linear-gradient(135deg,#ffc107,#ff9800);
  color:#000;font-weight:800;
}
.btn-cancelar{background:#dc3545;color:#fff;}
.btn:hover{transform:translateY(-2px);}
.btn-login{
  background:linear-gradient(135deg,#ffc107,#ff8f00);
  color:#000;
}
.login-form{
  display:none;position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.9);z-index:9999;
  justify-content:center;align-items:center;flex-direction:column;
}
.login-form input{
  width:300px;max-width:90vw;padding:15px;border-radius:12px;
  border:none;font-size:18px;margin-bottom:15px;
  background:rgba(255,255,255,0.9);
}
.login-btn{
  width:300px;max-width:90vw;padding:15px 20px;border:none;
  border-radius:12px;background:linear-gradient(135deg,#28a745,#20c997);
  color:#fff;font-size:18px;font-weight:700;cursor:pointer;
  box-shadow:0 8px 20px rgba(40,167,69,0.4);
}
.login-btn:hover{transform:translateY(-2px);}
#btnFlutuante{
  position:fixed;bottom:25px;right:25px;width:70px;height:70px;
  border:none;border-radius:50%;
  background:linear-gradient(135deg,#28a745,#20c997);
  color:white;font-size:40px;font-weight:bold;
  cursor:pointer;box-shadow:0 8px 25px rgba(0,0,0,0.4);
  z-index:9999;transition:transform 0.3s ease;
}
#btnFlutuante:hover{transform:scale(1.1);}
@media(max-width:500px){
  .oferta-header{flex-direction:column;gap:8px;text-align:center;}
  .btn-group{flex-direction:column;width:100%;}
}
</style>
</head>
<body>
<div class="container">
  <h1>üèê Liga 4x4 - Agendamentos</h1>
  <div class="public-notice">
    <strong>üëÄ P√∫blico:</strong> Veja ofertas e confirmados<br>
    <strong>üîê Login:</strong> Para criar ou aceitar jogos
  </div>
  <h2>‚è∞ Todas as ofertas</h2>
  <div id="listaOfertas" class="ofertas">Carregando...</div>
</div>

<!-- Bot√£o flutuante -->
<button id="btnFlutuante" title="Nova Oferta">Ôºã</button>

<!-- Tela de Login -->
<div id="loginScreen" class="login-form">
  <h1 style="margin-bottom:20px;">üîê Entrar</h1>
  <input type="password" id="senhaInput" placeholder="Senha do time ou admin">
  <button class="login-btn" onclick="entrar()">Entrar</button>
  <button class="btn btn-login" onclick="fecharLogin()" style="margin-top:15px;width:auto;">Cancelar</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
firebase.initializeApp({
  apiKey: "AIzaSyCovHcUFKP9dtwRxfnajhvGUgluCFp0HVQ",
  authDomain: "liga4x4volei-71358.firebaseapp.com",
  projectId: "liga4x4volei-71358"
});
const db=firebase.firestore();
const REF=db.collection("ofertasHorario");

const SENHAS_TIMES={
  "liga4x4":"ADMIN",
  "watchatchara":"Watchatchara",
  "iron":"Iron",
  "matrix":"Matrix",
  "filhosdafenix":"Filhos da F√™nix",
  "summer":"Summer",
  "hungers":"Hungers",
  "voleitche":"V√¥lei Tche",
  "conflitus":"Conflitus",
  "baroesdalargadinha":"Bar√µes da Largadinha",
  "falcoes":"Falc√µes",
  "time11":"Time 11",
  "time12":"Time 12"
};
let usuarioAtual=null;

function mostrarLogin(){document.getElementById('loginScreen').style.display='flex';}
function fecharLogin(){document.getElementById('loginScreen').style.display='none';document.getElementById('senhaInput').value='';}

function entrar(){
  const senha=document.getElementById('senhaInput').value.toLowerCase().trim();
  if(senha==="liga4x4") usuarioAtual={nome:"ADMIN",isAdmin:true};
  else if(SENHAS_TIMES[senha]) usuarioAtual={nome:SENHAS_TIMES[senha],isAdmin:false};
  else{alert("Senha inv√°lida!");return;}
  fecharLogin();carregarOfertas();alert(`‚úÖ Logado como ${usuarioAtual.nome}`);
}

document.getElementById('btnFlutuante').addEventListener('click',()=>{
  if(!usuarioAtual) mostrarLogin();
  else criarOfertaPrompt();
});

async function carregarOfertas(){
  const lista=document.getElementById('listaOfertas');
  const snap=await REF.orderBy("dataCriacao","desc").get();
  if(snap.empty){lista.innerHTML='<div style="text-align:center;padding:20px;">üì≠ Nenhuma oferta</div>';return;}
  let html='';
  snap.forEach(doc=>{
    const o=doc.data();
    const dataFmt=new Date(o.data).toLocaleDateString('pt-BR');
    const statusClass=o.status==='confirmado'?'status-confirmado':'status-disponivel';
    const statusTxt=o.status==='confirmado'?'‚úÖ Confirmado':'‚è≥ Dispon√≠vel';
    html+=`
    <div class="oferta">
      <div class="oferta-header"><h3>${o.quadra} ‚Äì ${o.hora}</h3><span class="status ${statusClass}">${statusTxt}</span></div>
      <div class="oferta-detalhes">üìÖ ${dataFmt}<br>üèê ${o.timeOfertante} ${o.aceitoPor?`x <strong>${o.aceitoPor}</strong>`:'(aguardando)'}</div>
      ${usuarioAtual?renderBotoes(doc.id,o):''}
    </div>`;
  });
  lista.innerHTML=html;
}

function renderBotoes(id,o){
  let bts='';
  if(o.status==='disponivel' && !o.aceitoPor && usuarioAtual && !usuarioAtual.isAdmin && usuarioAtual.nome!==o.timeOfertante){
    bts+=`<button class="btn btn-aceitar" onclick="aceitarOferta('${id}')">‚úÖ Aceitar</button>`;
  }
  if(usuarioAtual && (usuarioAtual.isAdmin || usuarioAtual.nome===o.timeOfertante)){
    bts+=`<button class="btn btn-cancelar" onclick="cancelarOferta('${id}')">‚ùå Cancelar</button>`;
  }
  return `<div style="margin-top:10px;">${bts}</div>`;
}

async function criarOfertaPrompt(){
  const quadra=prompt("Quadra (ex: Arena Bel√©m):");
  const data=prompt("Data (AAAA-MM-DD):");
  const hora=prompt("Hora (HH:MM):");
  if(!quadra||!data||!hora)return;
  const dados={
    timeOfertante:usuarioAtual.isAdmin?"ADMIN":usuarioAtual.nome,
    quadra,data,hora,
    status:"disponivel",aceitoPor:null,
    dataCriacao:firebase.firestore.FieldValue.serverTimestamp()
  };
  await REF.add(dados);
  alert("‚úÖ Oferta criada!");
  carregarOfertas();
}

async function aceitarOferta(id){
  await REF.doc(id).update({status:"confirmado",aceitoPor:usuarioAtual.nome});
  alert("üéâ Jogo confirmado!");
  carregarOfertas();
}
async function cancelarOferta(id){
  if(confirm("Cancelar oferta?")){await REF.doc(id).delete();carregarOfertas();}
}

carregarOfertas();
</script>
</body>
</html>
